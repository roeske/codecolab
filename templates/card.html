<!-- Static created timestamp -->
<div class="card_top">
    <div>
        <a data-state="{{ card.is_completed }}" class="btn card_complete" href="/project/{{ project_name }}/cards/{{ card._id }}/complete">
            <!-- Show the appropriate toggle state, but also make it easy
                 to change from javascript by manipulating the DOM -->
            {% if card.is_completed == True %}
                {% set display_complete = "inline;" %}
                {% set display_incomplete = "none;" %}
            {% else %}
                {% set display_incomplete = "inline;" %}
                {% set display_complete = "none;" %}
            {% endif %} 

            <div style="display: {{ display_complete }}" 
                  class="complete">
                  <div style="float: left;">Complete&nbsp;</div>
                  <div class="icon">&#10003;</div>
                  <div class="clear"></div>
            </div>

            
            <div style="display: {{ display_incomplete }}"
                  class="incomplete">Finish&nbsp;</div>
        </a>
    </div>
    <div class="clear"></div>
</div>

<!-- Editable Title "text" field -->
<p><span class="editable text">{{ card.text }}</span></p>

<br />
<!-- Editable description field -->
<div class="clear"></div>
<pre class="editable description">{{ card.description }}</pre>
<br />
<p>Difficulty:&nbsp;&nbsp;&nbsp;<span class="editable difficulty" data-card-id="{{ card._id }}" data-score="{{ card.score }}"></span></p>

<!-- Select milestone -->
<form action="/project/{{ project_name }}/cards/{{ card._id }}/select_milestone"
      method="POST" 
      class="milestone">
   
    <h3 class="card_section">Milestone</h3>
    
    <select id="select_milestone">
        <option data-id="-1">None</option>
        {% for milestone in project.milestones %}
        
            <option 
                {% if milestone._id == card.milestone_id %}
                    selected
                {% endif %}
                data-card-id="{{ card.milestone_id }}" 
                data-id="{{ milestone._id }}">
                
                {{ milestone.name }}
            </option>

        {% endfor %}
    </select>

</form>

{% include 'card_comments.html' %}

<form class="comments" action="/project/{{ project_name }}/cards/{{ card._id }}/comment" method="POST">
    <ul class="structural" style="padding: 0; margin: 0;">
        <li> 
            <textarea placeholder="Comment..." name="text" id="text"/>
        </li>

        <li>
            <input class="btn" style="float: right; margin-right: 0;" type="submit" name="submit" value="Add Comment" />
            <div style="clear: both;"></div>
        </li>
    </ul>
</form>


<form class="uploads" action="/project/{{ project_name }}/cards/{{ card._id }}/attach" method="POST">
    <ul class="structural">

        <li> 
            <input type="file"  name="file" id="file" />
        </li>

        <li>
            <div style="float: right;">
                <input type="submit" name="submit" value="Attach File" class="btn"/>
            </div>
            <div style="clear: both;"></div>
        </li>
    </ul>
</form>

<h3 class="comments_title">Attachments</h3>

<ul class="attachments structural">
   {% for file in card.attachments %}
   <li>
        <a href="/uploads/{{ file.filename }}">{{ file.filename }}</a>
   </li>
   {% endfor %}
</ul>
<!-- Run code to make above editables work -->
<script type="text/javascript">

$(document).ready(function() {
    var project_name = "{{ project_name }}"
    var card_id = "{{ card._id }}"
    var modal_selector = "#modal_" + "{{ card._id }}"

    var modal = $(modal_selector)

    console.log("project_name="+project_name)
    console.log("card_id="+card_id)
    console.log("modal_selector="+modal_selector)

    cc_make_card_editable(project_name, modal, card_id)
    cc_connect_comment_form(project_name, modal, card_id)
    cc_connect_upload_form(project_name, modal, card_id)
    cc_connect_milestone_spinner(project_name, modal, card_id)
    cc_connect_complete_button(project_name, modal, card_id)
})
</script>
