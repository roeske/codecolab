{% include "header.html" %}
{% include "project_navbar.html" %}
<div class="container _content">
  <div class="row">
    <div class="col-md-3 bs-docs-sidebar">
      <div class="row">
        <div class="col-md-8">
          <ul class="nav nav-pills nav-stacked bs-docs-sidenav affix-top">
          {% for p in projects %}
            {% if p._id == luser.last_project_id %}
              {% set active = "active" %}
            {% endif %}
            <li class="_project_nav_link {{ active }}">
            {% set active = "" %}
              <a data-id="{{ p._id }}" class="active">
                {{ p.name }}
                <div class="clearfix"></div>
              </a>
            </li>
          {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <div class="col-md-8">
      <div id="__project_page_container">
        {% include "dashboard.html" %}
      </div>
    </div>
  </div>
</div>
</div> {% include "footer.html" %}
<script type="text/javascript">

// stub so we can replace with nicer alert.
function cc_alert(msg) {
  alert(msg);
}


function load_project_page(tab, project_id) {
  $.get("/project_id/" + project_id + "/" + tab, function(data) {
    $("#__project_page_container").html(data);
  }).fail(function() {
    cc_alert("error loading page.");
  });
}


$(document).ready(function() {
  // When loading the index, the last project the user visited is 
  // restored.
  var last_project_id = {{ luser.last_project_id }};

  // remembering the last tab the user was on is not currently planned,
  // so default it to the dashboard.
  var last_tab = "dashboard";

  // handle switching projects
  //----------------------------------------------------------------------
  $("._project_nav_link").click(function() {
    var project_id = $(this).find("a").data("id");

    if (project_id != last_project_id) {

      $("._project_nav_link").removeClass("active");
      $(this).addClass("active");

      load_project_page(last_tab, project_id);
      last_project_id = project_id;
    }

    return false;
  });

  // handle switching project pages, via tabs
  //----------------------------------------------------------------------
  $("._tab").click(function() {
    var tab = $(this).data("tab"); 
    if (tab != last_tab) {
      $("._tab").removeClass("active");
      $(this).addClass("active");       
      load_project_page(tab, last_project_id);
      last_tab = tab;
    }
  });
});
</script>
</body>
</html>
